<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FOUDEK â€“ ThÃ©orie et calculs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; padding:0; background:#0e0f14; color:#e6e7eb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Inter",sans-serif;
  line-height:1.6; }
.container { max-width:1200px; margin:auto; padding:40px 20px; }
h1,h2,h3{text-align:center; font-weight:700;}
h1{font-size:30px; margin-bottom:40px;}
h2{font-size:24px; margin:50px 0 20px;}
p{margin:16px 0; font-size:16px;}
ul{margin:16px 0 16px 20px;}
li{margin:8px 0;}
.separator{height:1px; background:#2a2c36; margin:50px 0;}
.formula{background:#1a1c25; border-radius:8px; padding:14px 18px;
  font-family:"JetBrains Mono",Consolas,monospace;font-size:15px;
  overflow-x:auto;margin:20px 0;text-align:center;}
.cards{display:flex; gap:20px; flex-wrap:wrap; justify-content:center; margin-top:40px;}
.card{background:#0e0f14; border:1px solid #2a2c36; border-radius:14px; padding:20px; width:300px;}
.card.blue{box-shadow:0 0 18px rgba(37, 99, 235, 0.35);}
.card.red{box-shadow:0 0 18px rgba(220, 38, 38, 0.35);}
label{display:block;margin-top:12px;font-size:14px;}
input,select{width:100%; margin-top:6px; padding:8px; background:#0e0f14; border:1px solid #3a3d4d; border-radius:6px; color:#e6e7eb;}
button{width:100%; margin-top:16px; padding:10px; border:none; border-radius:6px; background:#2563eb; color:white; font-weight:bold; cursor:pointer;}
.result{margin-top:10px; padding:10px; border-radius:999px; text-align:center; font-weight:bold; opacity:0.35; transition:opacity 0.3s, box-shadow 0.3s;}
.result.blue{background:#1d4ed8;}
.result.red{background:#dc2626;}
.result.active{opacity:1; box-shadow:0 0 20px rgba(255,255,255,0.25);}
.voteInfo{margin-top:5px; font-size:13px; color:#9ca3af;}
#simZone{display:flex; flex-wrap:wrap; gap:10px; margin-top:20px;}
.iaCard{background:#111; border:1px solid #2a2c36; border-radius:14px; padding:20px; margin-bottom:30px;}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ§  FOUDEK â€“ ThÃ©orie et probabilitÃ© hors intervalle avec IA</h1>

<!-- === IA === -->
<div class="iaCard">
<h2>Intelligence artificielle â€“ Calcul automatique</h2>
<label>Liste des joueurs (sÃ©parÃ©s par des virgules)</label>
<input id="iaPlayers" placeholder="ex: medna,kader,keraod,tilf,zytronx,player6,player7">
<label>Votes (ex: medna>kader, keraod>tilf)</label>
<input id="iaVotes" placeholder="ex: medna>kader, keraod>tilf">
<label>Morts nuit 1 (sÃ©parÃ©s par des virgules, si aucun laisse vide)</label>
<input id="iaDead" placeholder="ex: player5">
<button onclick="runIA()">Calculer proba</button>
<div id="iaResults"></div>
</div>

<h2>Pourquoi il nâ€™y a jamais plus de 1 loup sur 4</h2>
<p>Dans la technique de FOUDEK, on considÃ¨re uniquement les cas oÃ¹ un intervalle de 4 joueurs contient 0 ou 1 loup.</p>
<p>La raison est purement probabiliste : si un intervalle contenait 2 loups sur 4, alors la probabilitÃ© quâ€™un joueur innocent vote un innocent serait plus Ã©levÃ©e que la probabilitÃ© de voter un loup.</p>
<p>Autrement dit, dÃ©passer 1/4 rend la dÃ©cision irrationnelle pour un innocent cherchant Ã  optimiser son vote. Ces mondes sont donc exclus par construction dans la technique FOUDEK.</p>

<p>La thÃ©orie FOUDEK correspond Ã  une situation oÃ¹ un joueur innocent, **inconsciemment**, pense quâ€™il y a un loup hors de son intervalle immÃ©diat. Cette intuition guide ses votes et influence la formation des intervalles probables.</p>

<p>Dans une partie rÃ©elle, on peut repÃ©rer les indices de 1/4 maximum par diffÃ©rents comportements :</p>
<p>Une conversation entre deux joueurs peut rÃ©vÃ©ler des indices sur deux potentiels intervalles distincts.</p>
<p>Les contradictions subtiles dans les dÃ©bats montrent lâ€™influence limitÃ©e des loups et confirment quâ€™un intervalle de 4 ne peut contenir plus dâ€™un loup.</p>
<p>Si un intervalle de 4 joueurs contient un loup, les autres innocents vont naturellement voter Ã  la majoritÃ© hors du loup, renforÃ§ant la validitÃ© de lâ€™hypothÃ¨se 0 ou 1 loup par intervalle.</p>
<p>Les triangles de vote fournissent aussi un indicateur clÃ© : par exemple, si joueur A vote joueur C, joueur C vote joueur D, et joueur D vote joueur A, cela forme un cycle. Un tel triangle montre que chaque joueur influence un autre, mais aucun groupe de plus dâ€™un tiers ne peut dominer les votes sans crÃ©er de contradiction dans la logique rationnelle des innocents.</p>
<p>Ces comportements combinÃ©s, y compris les triangles et les sÃ©parations dâ€™intervalles, permettent dâ€™identifier les intervalles et dâ€™appliquer la probabilitÃ© hors intervalle de maniÃ¨re fiable.</p>

<div class="separator"></div>

<h2>DÃ©tail du calcul de la probabilitÃ© hors intervalle</h2>
<p>On note :</p>
<ul>
<li><strong>I</strong> : nombre de joueurs dans lâ€™intervalle</li>
<li><strong>R</strong> : nombre de joueurs hors intervalle</li>
<li><strong>L</strong> : nombre de loups vivants</li>
<li><strong>k</strong> : nombre de loups dans lâ€™intervalle</li>
</ul>

<div class="formula">C(I, k) Ã— C(R, L âˆ’ k)</div>
<div class="formula">(L âˆ’ k) / R</div>

<div class="separator"></div>

<h2>Ã‰quation universelle finale</h2>
<div class="formula">
P<sub>R</sub> =
Î£<sub>k = 0</sub><sup>1</sup>
(
C(I, k) Â· C(R, L âˆ’ k)
/
Î£<sub>i = 0</sub><sup>1</sup>
C(I, i) Â· C(R, L âˆ’ i)
)
Ã— (L âˆ’ k) / R
</div>

<div class="separator"></div>

<h2>Calcul de probabilitÃ©</h2>
<div class="cards">
<div class="card blue">
<h3>ðŸ”µ MÃ©thode FOUDEK</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I1" type="number">
<label>Joueurs hors intervalle</label>
<input id="R1" type="number">
<label>Loups vivants</label>
<input id="L1" type="number">
<button onclick="calcFoudek()">Calculer</button>
<div id="resF" class="result blue">â€”</div>
</div>

<div class="card red">
<h3>ðŸ”´ MÃ©thode classique</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I2" type="number">
<label>Joueurs hors intervalle</label>
<input id="R2" type="number">
<label>Loups vivants</label>
<input id="L2" type="number">
<button onclick="calcClassic()">Calculer</button>
<div id="resC" class="result red">â€”</div>
</div>
</div>

<div class="separator"></div>

<h2>ðŸŽ­ ActivitÃ© â€“ ProbabilitÃ©s hors intervalle</h2>
<div class="card">
<label>Nombre total de joueurs</label>
<input id="simN" type="number" value="7" min="6">
<label>Nombre de loups vivants</label>
<input id="simL" type="number" value="2">
<button onclick="genSim()">GÃ©nÃ©rer les joueurs</button>
</div>

<div id="simZone"></div>

<div class="card" style="margin-top:30px;">
<h3>Votes</h3>
<label>Vote 1 - Joueur :</label>
<select id="vote1voter" onchange="updateSim()"></select>
<select id="vote1target" onchange="updateSim()"></select>
<label>Vote 2 - Joueur (optionnel) :</label>
<select id="vote2voter" onchange="updateSim()"></select>
<select id="vote2target" onchange="updateSim()"></select>
</div>

</div>

<script>
function C(n,k){if(k<0||k>n)return 0;let r=1;for(let i=1;i<=k;i++)r*=(n-i+1)/i;return r;}

function calcFoudek(){
  const I=+I1.value,R=+R1.value,L=+L1.value;
  let num=0,den=0;
  for(let k=0;k<=1;k++){if(k>L||L-k>R) continue; const c=C(I,k)*C(R,L-k); den+=c; num+=c*((L-k)/R);}
  const p=(num/den)*100;
  resF.textContent=p.toFixed(1)+" %"; resF.classList.add("active");
}

function calcClassic(){
  const I=+I2.value,R=+R2.value,L=+L2.value;
  let num=0,den=0;
  for(let k=0;k<=2;k++){if(k>L||L-k>R) continue; const c=C(I,k)*C(R,L-k); den+=c; num+=c*((L-k)/R);}
  const p=(den>0)? (num/den)*100 : 0;
  resC.textContent=p.toFixed(1)+" %"; resC.classList.add("active");
}

/* === ACTIVITÃ‰ === */
function genSim(){
  const n=+simN.value,L=+simL.value;
  let html="", opts="";
  for(let i=1;i<=n;i++){
    html+=`<div class="card" id="card${i}" style="width:120px">
      <strong>Joueur ${i}</strong>
      <label><input type="checkbox" id="d${i}" onchange="updateSim()"/> Mort</label>
      <div class="result blue" id="pf${i}">FOUDEK : â€”</div>
      <div class="result red" id="pc${i}">Classique : â€”</div>
      <div class="voteInfo" id="voteInfo${i}"></div>
    </div>`;
    opts+=`<option value="${i}">Joueur ${i}</option>`;
  }
  vote1voter.innerHTML=opts; vote1target.innerHTML=opts;
  vote2voter.innerHTML=opts; vote2target.innerHTML=opts;
  simZone.innerHTML=html;
  updateSim();
}

function updateSim(){
  const n=+simN.value,L=+simL.value;
  const alive=[];
  for(let i=1;i<=n;i++){
    if(!document.getElementById("d"+i).checked) alive.push(i);
    document.getElementById("voteInfo"+i).textContent="";
    document.getElementById("pf"+i).textContent="FOUDEK : â€”";
    document.getElementById("pc"+i).textContent="Classique : â€”";
  }

  const votes=[];
  const v1v=+vote1voter.value,v1t=+vote1target.value;
  if(v1v&&v1t) votes.push({from:v1v,to:v1t});
  const v2v=+vote2voter.value,v2t=+vote2target.value;
  if(v2v&&v2t) votes.push({from:v2v,to:v2t});

  const inInterval=new Set();
  votes.forEach(v=>{
    let a=Math.min(v.from,v.to),b=Math.max(v.from,v.to);
    if(b-a+1>4) b=a+3;
    for(let i=a;i<=b;i++) inInterval.add(i);
  });

  const totalPlayers=alive.length;
  const totalOutside=totalPlayers-inInterval.size;

  alive.forEach(idx=>{
    if(inInterval.has(idx)) return;
    const R=totalOutside;
    const I=4; // Fixe l'intervalle Ã  4 comme dans les tableaux
    let numF=0,denF=0;
    for(let k=0;k<=1;k++){
      if(k>L||L-k>R) continue;
      const c=C(I,k)*C(R,L-k);
      denF+=c; numF+=c*((L-k)/R);
    }
    const pf=(denF>0)? (numF/denF)*100 : 0;

    let numC=0,denC=0;
    for(let k=0;k<=2;k++){
      if(k>L||L-k>R) continue;
      const c=C(I,k)*C(R,L-k);
      denC+=c; numC+=c*((L-k)/R);
    }
    const pc=(denC>0)? (numC/denC)*100 : 0;

    document.getElementById("pf"+idx).textContent="FOUDEK : "+pf.toFixed(1)+" %";
    document.getElementById("pc"+idx).textContent="Classique : "+pc.toFixed(1)+" %";
  });

  votes.forEach(v=>{
    document.getElementById("voteInfo"+v.to).textContent=`Joueur ${v.from} vote pour lui`;
  });
}

/* === IA corrigÃ©e === */
function runIA(){
  const players = document.getElementById("iaPlayers").value.split(",").map(s=>s.trim()).filter(s=>s);
  const votesInput = document.getElementById("iaVotes").value.split(",").map(s=>s.trim()).filter(s=>s);
  const deadInput = document.getElementById("iaDead").value.split(",").map(s=>s.trim()).filter(s=>s);

  const votes = votesInput.map(v=>{
    const [from,to]=v.split(">").map(s=>s.trim());
    return {from,to};
  });

  const alive = players.filter(p=>!deadInput.includes(p));

  const inInterval = new Set();
  votes.forEach(v=>{
    const fromIdx = players.indexOf(v.from);
    const toIdx = players.indexOf(v.to);
    const a=Math.min(fromIdx,toIdx), b=Math.max(fromIdx,toIdx);
    if(b-a+1>4) b=a+3;
    for(let i=a;i<=b;i++) inInterval.add(players[i]);
  });

  const totalOutside = alive.filter(p=>!inInterval.has(p)).length;

  const results = [];
  alive.forEach(p=>{
    if(inInterval.has(p)) return;
    const R = totalOutside;
    const I = 4; // Intervalle fixe pour FOUDEK

    // FOUDEK
    let numF=0, denF=0;
    for(let k=0;k<=1;k++){
      if(k>2||2-k>R) continue; // 2 loups max
      const c=C(I,k)*C(R,2-k);
      denF+=c; numF+=c*((2-k)/R);
    }
    const pf=(denF>0)? (numF/denF)*100 : 0;

    // Classique
    let numC=0, denC=0;
    for(let k=0;k<=2;k++){
      if(k>2||2-k>R) continue;
      const c=C(I,k)*C(R,2-k);
      denC+=c; numC+=c*((2-k)/R);
    }
    const pc=(denC>0)? (numC/denC)*100 : 0;

    results.push(`${p}: FOUDEK ${pf.toFixed(1)}%, Classique ${pc.toFixed(1)}%`);
  });

  iaResults.innerHTML = results.join("<br>") || "Tous les joueurs sont dans un intervalle";
}
</script>
</body>
</html>