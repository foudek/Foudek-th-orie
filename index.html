<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FOUDEK â€“ ThÃ©orie et calculs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  padding: 0;
  background: #0e0f14;
  color: #e6e7eb;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
               Roboto, Oxygen, Ubuntu, Cantarell, "Inter", sans-serif;
  line-height: 1.6;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 40px 20px;
}

h1, h2, h3 {
  text-align: center;
  font-weight: 700;
}

h1 {
  font-size: 30px;
  margin-bottom: 40px;
}

h2 {
  font-size: 24px;
  margin: 50px 0 20px;
}

p {
  margin: 16px 0;
  font-size: 16px;
}

ul {
  margin: 16px 0 16px 20px;
}

li {
  margin: 8px 0;
}

.separator {
  height: 1px;
  background: #2a2c36;
  margin: 50px 0;
}

.formula {
  background: #1a1c25;
  border-radius: 8px;
  padding: 14px 18px;
  font-family: "JetBrains Mono", Consolas, monospace;
  font-size: 15px;
  overflow-x: auto;
  margin: 20px 0;
  text-align: center;
}

.cards {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 40px;
}

.card {
  background: #0e0f14;
  border: 1px solid #2a2c36;
  border-radius: 14px;
  padding: 20px;
  width: 300px;
}

.card.blue {
  box-shadow: 0 0 18px rgba(37, 99, 235, 0.35);
}

.card.red {
  box-shadow: 0 0 18px rgba(220, 38, 38, 0.35);
}

label {
  display: block;
  margin-top: 12px;
  font-size: 14px;
}

input, select {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  background: #0e0f14;
  border: 1px solid #3a3d4d;
  border-radius: 6px;
  color: #e6e7eb;
}

button {
  width: 100%;
  margin-top: 16px;
  padding: 10px;
  border: none;
  border-radius: 6px;
  background: #2563eb;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

.result {
  margin-top: 10px;
  padding: 10px;
  border-radius: 999px;
  text-align: center;
  font-weight: bold;
  opacity: 0.35;
  transition: opacity 0.3s, box-shadow 0.3s;
}

.result.blue {
  background: #1d4ed8;
}

.result.red {
  background: #dc2626;
}

.result.active {
  opacity: 1;
  box-shadow: 0 0 20px rgba(255,255,255,0.25);
}

.voteInfo {
  margin-top: 5px;
  font-size: 13px;
  color: #9ca3af;
}
</style>
</head>

<body>
<div class="container">

<h1>FOUDEK â€“ ThÃ©orie et probabilitÃ© hors intervalle</h1>

<h2>Pourquoi il nâ€™y a jamais plus de 1 loup sur 4</h2>

<p>
Dans la technique de FOUDEK, on considÃ¨re uniquement les cas oÃ¹ un
intervalle de 4 joueurs contient 0 ou 1 loup.
</p>

<p>
La raison est purement probabiliste : si un intervalle contenait
2 loups sur 4, alors la probabilitÃ© quâ€™un joueur innocent vote un
innocent serait plus Ã©levÃ©e que la probabilitÃ© de voter un loup.
</p>

<p>
Autrement dit, dÃ©passer 1/4 rend la dÃ©cision irrationnelle pour
un innocent cherchant Ã  optimiser son vote. Ces mondes sont donc
exclus par construction dans la technique FOUDEK.
</p>

<div class="separator"></div>

<h2>DÃ©tail du calcul de la probabilitÃ© hors intervalle</h2>

<p>On note :</p>
<ul>
  <li><strong>I</strong> : nombre de joueurs dans lâ€™intervalle</li>
  <li><strong>R</strong> : nombre de joueurs hors intervalle</li>
  <li><strong>L</strong> : nombre de loups vivants</li>
  <li><strong>k</strong> : nombre de loups dans lâ€™intervalle</li>
</ul>

<div class="formula">
C(I, k) Ã— C(R, L âˆ’ k)
</div>

<div class="formula">
(L âˆ’ k) / R
</div>

<div class="separator"></div>

<h2>Ã‰quation universelle finale</h2>

<div class="formula">
P<sub>R</sub> =
Î£<sub>k = 0</sub><sup>1</sup>
(
C(I, k) Â· C(R, L âˆ’ k)
/
Î£<sub>i = 0</sub><sup>1</sup>
C(I, i) Â· C(R, L âˆ’ i)
)
Ã— (L âˆ’ k) / R
</div>

<div class="separator"></div>

<h2>Calcul de probabilitÃ©</h2>

<div class="cards">

<div class="card blue">
<h3>ðŸ”µ MÃ©thode FOUDEK</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I1" type="number">
<label>Joueurs hors intervalle</label>
<input id="R1" type="number">
<label>Loups vivants</label>
<input id="L1" type="number">
<button onclick="calcFoudek()">Calculer</button>
<div id="resF" class="result blue">â€”</div>
</div>

<div class="card red">
<h3>ðŸ”´ MÃ©thode classique</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I2" type="number">
<label>Joueurs hors intervalle</label>
<input id="R2" type="number">
<label>Loups vivants</label>
<input id="L2" type="number">
<button onclick="calcClassic()">Calculer</button>
<div id="resC" class="result red">â€”</div>
</div>

</div>

<div class="separator"></div>

<h2>ðŸŽ­ ActivitÃ© â€“ Vote FOUDEK multi-tours avec intervalles dynamiques</h2>

<p>
SÃ©lectionnez les joueurs vivants, qui est Â« vous Â» et indiquez jusquâ€™Ã  2 votes par tour. Les probabilitÃ©s se recalculent dynamiquement Ã  chaque tour en utilisant les votes pour crÃ©er les intervalles, limitÃ©s Ã  4 joueurs comme dans FOUDEK.
</p>

<div class="card">
  <label>Nombre total de joueurs</label>
  <input id="simN" type="number" value="8" min="6">

  <label>Nombre de loups vivants</label>
  <input id="simL" type="number" value="2">

  <button onclick="genSim()">GÃ©nÃ©rer les joueurs</button>
</div>

<div id="simZone" style="margin-top:30px;"></div>

<div class="card" style="margin-top:30px;">
  <h3>Votes</h3>
  <label>Vote 1 - Joueur :</label>
  <select id="vote1voter"></select>
  <select id="vote1target"></select>

  <label>Vote 2 - Joueur (optionnel) :</label>
  <select id="vote2voter"><option value="">Aucun</option></select>
  <select id="vote2target"><option value="">Aucun</option></select>

  <button onclick="runSim()">Appliquer le tour</button>
</div>

</div>

<script>
// combinaison C(n,k)
function C(n, k) {
  if(k<0||k>n) return 0;
  let r=1;
  for(let i=1;i<=k;i++) r*=(n-i+1)/i;
  return r;
}

// FOUDEK standard
function calcFoudek() {
  const I = +I1.value;
  const R = +R1.value;
  const L = +L1.value;
  let num=0, den=0;
  for(let k=0;k<=1;k++){
    if(k>L || L-k>R) continue;
    const c=C(I,k)*C(R,L-k);
    den+=c;
    num+=c*((L-k)/R);
  }
  const p=(num/den)*100;
  resF.textContent=p.toFixed(1)+" %";
  resF.classList.add("active");
}

// classique standard
function calcClassic(){
  const I=+I2.value;
  const R=+R2.value;
  const L=+L2.value;
  const p=(L/(I+R))*100;
  resC.textContent=p.toFixed(1)+" %";
  resC.classList.add("active");
}

/* === ACTIVITÃ‰ FOUDEK avec intervalles dynamiques et max 4 === */

let history=[];

function genSim(){
  history=[];
  const n=+simN.value;
  let html="", opts="";
  for(let i=1;i<=n;i++){
    html+=`
      <div class="card" id="card${i}">
        <strong>Joueur ${i}</strong>
        <label><input type="checkbox" id="d${i}"> Mort</label>
        <label><input type="radio" name="you" id="y${i}"> Vous</label>
        <div class="result blue" id="pf${i}">FOUDEK : â€”</div>
        <div class="result red" id="pc${i}">Classique : â€”</div>
        <div class="voteInfo" id="voteInfo${i}"></div>
      </div>`;
    opts+=`<option value="${i}">Joueur ${i}</option>`;
  }
  vote1voter.innerHTML=opts;
  vote1target.innerHTML=opts;
  vote2voter.innerHTML='<option value="">Aucun</option>'+opts;
  vote2target.innerHTML='<option value="">Aucun</option>'+opts;
  simZone.innerHTML=html;
}

function runSim(){
  const n=+simN.value;
  const L=+simL.value;
  const votes=[];

  // votes du tour
  const v1v=+vote1voter.value, v1t=+vote1target.value;
  if(v1v && v1t) votes.push({from:v1v,to:v1t});
  const v2v=vote2voter.value? +vote2voter.value:null;
  const v2t=vote2target.value? +vote2target.value:null;
  if(v2v && v2t) votes.push({from:v2v,to:v2t});
  history.push(votes);

  // rÃ©cupÃ©rer joueurs vivants et vous
  const alive=[];
  let youIndex=-1;
  for(let i=1;i<=n;i++){
    const dead=document.getElementById("d"+i).checked;
    if(document.getElementById("y"+i).checked) youIndex=i;
    else if(!dead) alive.push(i);
    document.getElementById("voteInfo"+i).textContent="";
  }

  // crÃ©er intervalles dynamiques Ã  partir des votes
  const intervals=[];
  history.forEach(tour=>{
    tour.forEach(v=>{
      if(alive.includes(v.from) && alive.includes(v.to)){
        const a=Math.min(v.from,v.to), b=Math.max(v.from,v.to);
        let size=b-a+1;
        // limiter intervalle Ã  4 joueurs max
        if(size>4) b=a+3;
        intervals.push([a,b]);
      }
    });
  });

  // fusion des intervalles qui se chevauchent
  const merged=[];
  intervals.sort((a,b)=>a[0]-b[0]);
  intervals.forEach(intv=>{
    if(!merged.length) merged.push(intv);
    else{
      const last=merged[merged.length-1];
      if(intv[0]<=last[1]+1) last[1]=Math.max(last[1],intv[1]);
      else merged.push(intv);
    }
  });

  // calcul FOUDEK pour chaque joueur hors vous
  alive.forEach(idx=>{
    let pf=0;
    let interval=null;
    merged.forEach(m=>{
      if(idx>=m[0] && idx<=m[1]) interval=m;
    });
    let I=interval? interval[1]-interval[0]+1 : 1;
    let R=alive.length - I;
    let num=0, den=0;
    for(let k=0;k<=1;k++){
      if(k>L || L-k>R) continue;
      const c=C(I,k)*C(R,L-k);
      den+=c;
      num+=c*((L-k)/R);
    }
    pf=(den>0)? (num/den)*100 : 0;
    const pc=(alive.length>0)? (L/alive.length)*100 :0;
    document.getElementById("pf"+idx).textContent="FOUDEK : "+pf.toFixed(1)+" %";
    document.getElementById("pc"+idx).textContent="Classique : "+pc.toFixed(1)+" %";
  });

  // affichage votes
  history.forEach(tour=>{
    tour.forEach(v=>{
      document.getElementById("voteInfo"+v.to).textContent+=`Joueur ${v.from} vote pour lui\n`;
    });
  });
}
</script>

</body>
</html>