<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FOUDEK â€“ ThÃ©orie et calculs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; padding:0; background:#0e0f14; color:#e6e7eb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Inter",sans-serif;
  line-height:1.6; }
.container { max-width:1200px; margin:auto; padding:40px 20px; }
h1,h2,h3{text-align:center; font-weight:700;}
h1{font-size:30px; margin-bottom:40px;}
h2{font-size:24px; margin:50px 0 20px;}
p{margin:16px 0; font-size:16px;}
ul{margin:16px 0 16px 20px;}
li{margin:8px 0;}
.separator{height:1px; background:#2a2c36; margin:50px 0;}
.formula{background:#1a1c25; border-radius:8px; padding:14px 18px;
  font-family:"JetBrains Mono",Consolas,monospace;font-size:15px;
  overflow-x:auto;margin:20px 0;text-align:center;}
.cards{display:flex; gap:20px; flex-wrap:wrap; justify-content:center; margin-top:40px;}
.card{background:#0e0f14; border:1px solid #2a2c36; border-radius:14px; padding:20px; width:300px;}
.card.blue{box-shadow:0 0 18px rgba(37, 99, 235, 0.35);}
.card.red{box-shadow:0 0 18px rgba(220, 38, 38, 0.35);}
label{display:block;margin-top:12px;}
input,select{width:100%; margin-top:6px; padding:8px; background:#0e0f14; border:1px solid #3a3d4d; border-radius:6px; color:#e6e7eb;}
button{width:100%; margin-top:16px; padding:10px; border:none; border-radius:6px; background:#2563eb; color:white; font-weight:bold; cursor:pointer;}
.result{margin-top:10px; padding:10px; border-radius:999px; text-align:center; font-weight:bold; opacity:0.35; transition:opacity 0.3s, box-shadow 0.3s;}
.result.blue{background:#1d4ed8;}
.result.red{background:#dc2626;}
.result.active{opacity:1; box-shadow:0 0 20px rgba(255,255,255,0.25);}
.voteInfo{margin-top:5px; font-size:13px; color:#9ca3af;}
#simZone{display:flex; flex-wrap:wrap; gap:10px; margin-top:20px;}
</style>
</head>

<body>
<div class="container">

<h1>IA â€“ ProbabilitÃ©s hors intervalle</h1>

<div class="card">
<h3>Configuration de la partie</h3>
<label>Liste des pseudos (sÃ©parÃ©s par des virgules)</label>
<input id="pseudoList" placeholder="ex: medna,kader,keraod,sangsue">
<label>Nombre de loups vivants</label>
<input type="number" id="LIA" value="2">
<label>Joueurs morts (optionnel)</label>
<input id="deadList" placeholder="ex: medna,keraod">
<label>Taille de lâ€™intervalle (2, 3 ou 4)</label>
<input type="number" id="intervalSize" value="4" min="2" max="4">
<label>Pseudos des joueurs dans lâ€™intervalle</label>
<input id="intervalList" placeholder="ex: kader,sangsue">
<button onclick="runIA()">Calculer probabilitÃ©s IA</button>
</div>

<div id="iaResults" class="cards"></div>

<div class="separator"></div>

<h1>FOUDEK â€“ ThÃ©orie et probabilitÃ© hors intervalle</h1>

<h2>Principe fondamental des intervalles</h2>

<p>
La thÃ©orie FOUDEK repose sur une hypothÃ¨se centrale :  
un joueur innocent cherche inconsciemment Ã  maximiser la probabilitÃ© de voter un loup.
</p>

<p>
Pour quâ€™un vote reste rationnel, la proportion de loups Ã  lâ€™intÃ©rieur dâ€™un intervalle
doit rester strictement infÃ©rieure Ã  la proportion de joueurs hors intervalle.
</p>

<h3>Limitation naturelle selon la taille de lâ€™intervalle</h3>


<p><strong>Intervalle de 2 joueurs</strong> : mondes possibles â†’ 0/2 ou 1/2<p>
<li><strong>Intervalle de 3 joueurs</strong> : mondes possibles â†’ 0/3 ou 1/3</li>
<li><strong>Intervalle de 4 joueurs</strong> : mondes possibles â†’ 0/4 ou 1/4</li>


<p>
DÃ¨s quâ€™un intervalle contient plus dâ€™un loup, la probabilitÃ© pour un innocent
de voter un innocent devient supÃ©rieure Ã  celle de voter un loup.
</p>

<p>
Ã€ ce moment prÃ©cis, le vote devient irrationnel :  
un innocent nâ€™a plus intÃ©rÃªt Ã  voter dans lâ€™intervalle.
Ces mondes sont donc exclus par construction dans FOUDEK.
</p>

<h3>ConsÃ©quence directe</h3>

<p>
FOUDEK ne cherche pas Ã  deviner oÃ¹ sont les loups,
mais Ã  Ã©liminer les mondes oÃ¹ un vote rationnel nâ€™existerait plus.
</p>

<p>
Les intervalles observÃ©s dans une partie rÃ©elle
(2, 3 ou 4 joueurs) Ã©mergent naturellement des discussions,
des votes croisÃ©s et des triangles de vote.
</p>

<div class="separator"></div>

<h2>Calcul de probabilitÃ© hors intervalle</h2>

<p>On note :</p>
<ul>
<li><strong>I</strong> : taille de lâ€™intervalle (2, 3 ou 4)</li>
<li><strong>R</strong> : nombre de joueurs hors intervalle</li>
<li><strong>L</strong> : nombre de loups vivants</li>
<li><strong>k</strong> : nombre de loups dans lâ€™intervalle (0 ou 1)</li>
</ul>

<div class="formula">C(I, k) Ã— C(R, L âˆ’ k)</div>
<div class="formula">(L âˆ’ k) / R</div>

<div class="separator"></div>

<h2>Ã‰quation universelle FOUDEK</h2>

<div class="formula">
P =
Î£<sub>k = 0</sub><sup>1</sup>
(
C(I, k) Â· C(R, L âˆ’ k)
/
Î£<sub>i = 0</sub><sup>1</sup>
C(I, i) Â· C(R, L âˆ’ i)
)
Ã— (L âˆ’ k) / R
</div>

<div class="separator"></div>

<h2>Calcul de probabilitÃ©</h2>

<div class="cards">
<div class="card blue">
<h3>ðŸ”µ MÃ©thode FOUDEK</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I1" type="number">
<label>Joueurs hors intervalle</label>
<input id="R1" type="number">
<label>Loups vivants</label>
<input id="L1" type="number">
<button onclick="calcFoudek()">Calculer</button>
<div id="resF" class="result blue">â€”</div>
</div>

<div class="card red">
<h3>ðŸ”´ MÃ©thode classique</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I2" type="number">
<label>Joueurs hors intervalle</label>
<input id="R2" type="number">
<label>Loups vivants</label>
<input id="L2" type="number">
<button onclick="calcClassic()">Calculer</button>
<div id="resC" class="result red">â€”</div>
</div>
</div>

<div class="separator"></div>

<h2>ðŸŽ­ ActivitÃ© â€“ ProbabilitÃ©s hors intervalle</h2>

<div class="card">
<label>Nombre total de joueurs</label>
<input id="simN" type="number" value="7" min="6">
<label>Nombre de loups vivants</label>
<input id="simL" type="number" value="2">
<button onclick="genSim()">GÃ©nÃ©rer les joueurs</button>
</div>

<div id="simZone"></div>

<div class="card" style="margin-top:30px;">
<h3>Votes</h3>
<label>Vote 1 - Joueur :</label>
<select id="vote1voter" onchange="updateSim()"></select>
<select id="vote1target" onchange="updateSim()"></select>
<label>Vote 2 - Joueur (optionnel) :</label>
<select id="vote2voter" onchange="updateSim()"></select>
<select id="vote2target" onchange="updateSim()"></select>
</div>

</div>

<script>
function C(n,k){
  if(k<0||k>n) return 0;
  let r=1;
  for(let i=1;i<=k;i++) r*=(n-i+1)/i;
  return r;
}

function foudekProb(I,R,L){
  let num=0,den=0;
  for(let k=0;k<=1;k++){
    if(k>L||L-k>R) continue;
    const c=C(I,k)*C(R,L-k);
    den+=c;
    num+=c*((L-k)/R);
  }
  return den>0 ? (num/den)*100 : 0;
}

function classicProb(I,R,L){
  let num=0,den=0;
  for(let k=0;k<=I;k++){
    if(k>L||L-k>R) continue;
    const c=C(I,k)*C(R,L-k);
    den+=c;
    num+=c*((L-k)/R);
  }
  return den>0 ? (num/den)*100 : 0;
}

function calcFoudek(){
  resF.textContent=foudekProb(+I1.value,+R1.value,+L1.value).toFixed(1)+" %";
  resF.classList.add("active");
}

function calcClassic(){
  resC.textContent=classicProb(+I2.value,+R2.value,+L2.value).toFixed(1)+" %";
  resC.classList.add("active");
}

function genSim(){
  const n=+simN.value;
  let html="",opts="";
  for(let i=1;i<=n;i++){
    html+=`<div class="card" style="width:120px">
      <strong>Joueur ${i}</strong>
      <label><input type="checkbox" id="d${i}" onchange="updateSim()"> Mort</label>
      <div class="result blue" id="pf${i}">FOUDEK : â€”</div>
      <div class="result red" id="pc${i}">Classique : â€”</div>
      <div class="voteInfo" id="voteInfo${i}"></div>
    </div>`;
    opts+=`<option value="${i}">Joueur ${i}</option>`;
  }
  vote1voter.innerHTML=vote1target.innerHTML=vote2voter.innerHTML=vote2target.innerHTML=opts;
  simZone.innerHTML=html;
  updateSim();
}

function updateSim(){
  const n=+simN.value,L=+simL.value;
  const alive=[];
  for(let i=1;i<=n;i++){
    if(!document.getElementById("d"+i).checked) alive.push(i);
    document.getElementById("voteInfo"+i).textContent="";
    document.getElementById("pf"+i).textContent="FOUDEK : â€”";
    document.getElementById("pc"+i).textContent="Classique : â€”";
  }

  const votes=[];
  if(vote1voter.value&&vote1target.value) votes.push({from:+vote1voter.value,to:+vote1target.value});
  if(vote2voter.value&&vote2target.value) votes.push({from:+vote2voter.value,to:+vote2target.value});

  const interval=new Set();
  votes.forEach(v=>{
    let a=Math.min(v.from,v.to),b=Math.max(v.from,v.to);
    for(let i=a;i<=b;i++) interval.add(i);
  });

  const I=Math.min(4,interval.size);
  const R=alive.filter(i=>!interval.has(i)).length;

  alive.forEach(i=>{
    if(interval.has(i)) return;
    document.getElementById("pf"+i).textContent="FOUDEK : "+foudekProb(I,R,L).toFixed(1)+" %";
    document.getElementById("pc"+i).textContent="Classique : "+classicProb(I,R,L).toFixed(1)+" %";
  });

  votes.forEach(v=>{
    document.getElementById("voteInfo"+v.to).textContent=`Joueur ${v.from} vote pour lui`;
  });
}

function runIA(){
  const pseudos=pseudoList.value.split(",").map(s=>s.trim()).filter(Boolean);
  const dead=deadList.value.split(",").map(s=>s.trim()).filter(Boolean);
  const interval=intervalList.value.split(",").map(s=>s.trim()).filter(Boolean);
  const I=Math.min(4,+intervalSize.value);
  const L=+LIA.value;

  const alive=pseudos.filter(p=>!dead.includes(p));
  const outside=alive.filter(p=>!interval.includes(p));
  const R=outside.length;

  let html="";
  outside.forEach(p=>{
    html+=`<div class="card">
      <strong>${p}</strong>
      <div class="result blue active">FOUDEK : ${foudekProb(I,R,L).toFixed(1)} %</div>
      <div class="result red active">Classique : ${classicProb(I,R,L).toFixed(1)} %</div>
    </div>`;
  });
  iaResults.innerHTML=html;
}
</script>
</body>
</html>