<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FOUDEK â€“ ThÃ©orie et calculs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; padding:0; background:#0e0f14; color:#e6e7eb;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Inter",sans-serif;
  line-height:1.6; }
.container { max-width:1200px; margin:auto; padding:40px 20px; }
h1,h2,h3{text-align:center; font-weight:700;}
h1{font-size:30px; margin-bottom:40px;}
h2{font-size:24px; margin:50px 0 20px;}
p{margin:16px 0; font-size:16px;}
ul{margin:16px 0 16px 20px;}
li{margin:8px 0;}
.separator{height:1px; background:#2a2c36; margin:50px 0;}
.formula{background:#1a1c25; border-radius:8px; padding:14px 18px;
  font-family:"JetBrains Mono",Consolas,monospace;font-size:15px;
  overflow-x:auto;margin:20px 0;text-align:center;}
.cards{display:flex; gap:20px; flex-wrap:wrap; justify-content:center; margin-top:40px;}
.card{background:#0e0f14; border:1px solid #2a2c36; border-radius:14px; padding:20px; width:300px;}
.card.blue{box-shadow:0 0 18px rgba(37, 99, 235, 0.35);}
.card.red{box-shadow:0 0 18px rgba(220, 38, 38, 0.35);}
label{display:block;margin-top:12px;}
input,select{width:100%; margin-top:6px; padding:8px; background:#0e0f14; border:1px solid #3a3d4d; border-radius:6px; color:#e6e7eb;}
button{width:100%; margin-top:16px; padding:10px; border:none; border-radius:6px; background:#2563eb; color:white; font-weight:bold; cursor:pointer;}
.result{margin-top:10px; padding:10px; border-radius:999px; text-align:center; font-weight:bold; opacity:0.35; transition:opacity 0.3s, box-shadow 0.3s;}
.result.blue{background:#1d4ed8;}
.result.red{background:#dc2626;}
.result.active{opacity:1; box-shadow:0 0 20px rgba(255,255,255,0.25);}
.voteInfo{margin-top:5px; font-size:13px; color:#9ca3af;}
#simZone{display:flex; flex-wrap:wrap; gap:10px; margin-top:20px;}
</style>
</head>

<body>
<div class="container">

<h1>IA â€“ ProbabilitÃ©s hors intervalle</h1>

<div class="card">
<h3>Configuration de la partie</h3>
<label>Liste des pseudos (sÃ©parÃ©s par des virgules)</label>
<input id="pseudoList" placeholder="ex: medna,kader,keraod,tilf">
<label>Nombre de loups vivants</label>
<input type="number" id="LIA" value="2">
<label>Joueurs morts (optionnel)</label>
<input id="deadList" placeholder="ex: medna,keraod">
<label>Taille de lâ€™intervalle (2, 3 ou 4)</label>
<input type="number" id="intervalCount" value="4" min="2" max="4">
<label>Pseudos des joueurs dans lâ€™intervalle</label>
<input id="intervalPlayers" placeholder="ex: kader,tilf">
<button onclick="runIA()">Calculer probabilitÃ©s IA</button>
</div>

<div id="iaResults" class="cards"></div>

<div class="separator"></div>

<h1>FOUDEK â€“ ThÃ©orie et probabilitÃ© hors intervalle</h1>

<h2>Pourquoi les intervalles sont limitÃ©s</h2>
<p>La technique FOUDEK repose sur une hypothÃ¨se fondamentale : un intervalle rationnel ne peut contenir quâ€™un seul loup au maximum.</p>
<p>Cette rÃ¨gle sâ€™adapte dynamiquement Ã  la taille de lâ€™intervalle :</p>
<ul>
<li>Intervalle de 2 joueurs â†’ 0 ou 1 loup (1/2 max)</li>
<li>Intervalle de 3 joueurs â†’ 0 ou 1 loup (1/3 max)</li>
<li>Intervalle de 4 joueurs â†’ 0 ou 1 loup (1/4 max)</li>
</ul>
<p>Au-delÃ  de ces seuils, la probabilitÃ© quâ€™un innocent vote un innocent devient supÃ©rieure Ã  celle de voter un loup, ce qui rend la dÃ©cision irrationnelle.</p>

<div class="separator"></div>

<h2>DÃ©tail du calcul</h2>
<ul>
<li><strong>I</strong> : taille de lâ€™intervalle (2, 3 ou 4)</li>
<li><strong>R</strong> : joueurs hors intervalle</li>
<li><strong>L</strong> : loups vivants</li>
<li><strong>k</strong> : loups dans lâ€™intervalle (0 ou 1)</li>
</ul>

<div class="formula">C(I, k) Ã— C(R, L âˆ’ k)</div>
<div class="formula">(L âˆ’ k) / R</div>

<div class="separator"></div>

<h2>Ã‰quation universelle</h2>
<div class="formula">
P =
Î£<sub>k = 0</sub><sup>1</sup>
(
C(I, k) Â· C(R, L âˆ’ k)
/
Î£<sub>i = 0</sub><sup>1</sup>
C(I, i) Â· C(R, L âˆ’ i)
)
Ã— (L âˆ’ k) / R
</div>

<div class="separator"></div>

<h2>Calcul de probabilitÃ©</h2>
<div class="cards">
<div class="card blue">
<h3>ðŸ”µ MÃ©thode FOUDEK</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I1" type="number">
<label>Joueurs hors intervalle</label>
<input id="R1" type="number">
<label>Loups vivants</label>
<input id="L1" type="number">
<button onclick="calcFoudek()">Calculer</button>
<div id="resF" class="result blue">â€”</div>
</div>

<div class="card red">
<h3>ðŸ”´ MÃ©thode classique</h3>
<label>Joueurs dans lâ€™intervalle</label>
<input id="I2" type="number">
<label>Joueurs hors intervalle</label>
<input id="R2" type="number">
<label>Loups vivants</label>
<input id="L2" type="number">
<button onclick="calcClassic()">Calculer</button>
<div id="resC" class="result red">â€”</div>
</div>
</div>

<div class="separator"></div>

<h2>ðŸŽ­ ActivitÃ© â€“ ProbabilitÃ©s hors intervalle</h2>
<div class="card">
<label>Nombre total de joueurs</label>
<input id="simN" type="number" value="7" min="6">
<label>Nombre de loups vivants</label>
<input id="simL" type="number" value="2">
<button onclick="genSim()">GÃ©nÃ©rer les joueurs</button>
</div>

<div id="simZone"></div>

<div class="card" style="margin-top:30px;">
<h3>Votes</h3>
<label>Vote 1 - Joueur :</label>
<select id="vote1voter" onchange="updateSim()"></select>
<select id="vote1target" onchange="updateSim()"></select>
<label>Vote 2 - Joueur (optionnel) :</label>
<select id="vote2voter" onchange="updateSim()"></select>
<select id="vote2target" onchange="updateSim()"></select>
</div>

</div>

<script>
function C(n,k){
  if(k<0||k>n) return 0;
  let r=1;
  for(let i=1;i<=k;i++) r*=(n-i+1)/i;
  return r;
}

/* ===== CALCULS ===== */
function calcFoudek(){
  const I=+I1.value,R=+R1.value,L=+L1.value;
  let num=0,den=0;
  for(let k=0;k<=1;k++){
    if(k>L||L-k>R) continue;
    const c=C(I,k)*C(R,L-k);
    den+=c;
    num+=c*((L-k)/R);
  }
  resF.textContent=((num/den)*100).toFixed(1)+" %";
  resF.classList.add("active");
}

function calcClassic(){
  const I=+I2.value,R=+R2.value,L=+L2.value;
  let num=0,den=0;
  for(let k=0;k<=I;k++){
    if(k>L||L-k>R) continue;
    const c=C(I,k)*C(R,L-k);
    den+=c;
    num+=c*((L-k)/R);
  }
  resC.textContent=((num/den)*100).toFixed(1)+" %";
  resC.classList.add("active");
}

/* ===== ACTIVITÃ‰ ===== */
function genSim(){
  const n=+simN.value;
  let html="", opts="";
  for(let i=1;i<=n;i++){
    html+=`<div class="card" style="width:120px">
      <strong>Joueur ${i}</strong>
      <label><input type="checkbox" id="d${i}" onchange="updateSim()"> Mort</label>
      <div class="result blue" id="pf${i}">FOUDEK : â€”</div>
      <div class="result red" id="pc${i}">Classique : â€”</div>
      <div class="voteInfo" id="voteInfo${i}"></div>
    </div>`;
    opts+=`<option value="${i}">Joueur ${i}</option>`;
  }
  vote1voter.innerHTML=opts;
  vote1target.innerHTML=opts;
  vote2voter.innerHTML=opts;
  vote2target.innerHTML=opts;
  simZone.innerHTML=html;
  updateSim();
}

function updateSim(){
  const n=+simN.value,L=+simL.value;
  const alive=[];
  for(let i=1;i<=n;i++){
    if(!document.getElementById("d"+i).checked) alive.push(i);
    pf${i}.textContent="FOUDEK : â€”";
    pc${i}.textContent="Classique : â€”";
    voteInfo${i}.textContent="";
  }

  const votes=[];
  if(vote1voter.value && vote1target.value) votes.push({from:+vote1voter.value,to:+vote1target.value});
  if(vote2voter.value && vote2target.value) votes.push({from:+vote2voter.value,to:+vote2target.value});

  const inInterval=new Set();
  votes.forEach(v=>{
    let a=Math.min(v.from,v.to), b=Math.max(v.from,v.to);
    for(let i=a;i<=b;i++) inInterval.add(i);
  });

  const R=alive.filter(i=>!inInterval.has(i)).length;
  const I=Math.min(4,inInterval.size);

  alive.forEach(i=>{
    if(inInterval.has(i)) return;
    let num=0,den=0;
    for(let k=0;k<=1;k++){
      if(k>L||L-k>R) continue;
      const c=C(I,k)*C(R,L-k);
      den+=c;
      num+=c*((L-k)/R);
    }
    pf${i}.textContent="FOUDEK : "+((num/den)*100).toFixed(1)+" %";
  });
}

/* ===== IA ===== */
function runIA(){
  const pseudos=pseudoList.value.split(",").map(s=>s.trim()).filter(Boolean);
  const dead=deadList.value.split(",").map(s=>s.trim()).filter(Boolean);
  const intervalPlayers=intervalPlayers.value.split(",").map(s=>s.trim()).filter(Boolean);
  const I=Math.min(4,+intervalCount.value);
  const L=+LIA.value;

  const alive=pseudos.filter(p=>!dead.includes(p));
  const outside=alive.filter(p=>!intervalPlayers.includes(p));
  const R=outside.length;

  let html="";
  outside.forEach(p=>{
    let num=0,den=0;
    for(let k=0;k<=1;k++){
      if(k>L||L-k>R) continue;
      const c=C(I,k)*C(R,L-k);
      den+=c;
      num+=c*((L-k)/R);
    }
    html+=`<div class="card">
      <strong>${p}</strong>
      <div class="result blue active">FOUDEK : ${((num/den)*100).toFixed(1)} %</div>
    </div>`;
  });
  iaResults.innerHTML=html;
}
</script>
</body>
</html>